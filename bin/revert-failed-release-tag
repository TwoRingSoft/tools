#! /usr/bin/env ruby

require 'optparse'

podspec = ARGV[0]

options = {}
parser = OptionParser.new do |opts|
  opts.banner = <<~BANNER

    Usage: revert-failed-release-tag <podspec-name>

           Delete any tags created for a release process that winds up failing, so it can be retried without failing on git trying to recreate an existing tag.

    Options:

  BANNER
  opts.on('-h', '--help', 'Print this help message.') do 
    puts opts
    exit
  end
end
parser.parse!

version_file = "#{podspec}.podspec"
version = `vrsn --read --file #{version_file}`.strip
tag = "#{podspec}-#{version}"
echoexec "git tag --delete #{tag}"
echoexec "git push --delete origin #{tag}"
